(function(){"use strict";angular.module("module.tac.keyboard",["angularLocalStorage","module.tac.navigable","module.tac.svg"]).factory("tac.keyboard",["$modal","tac.keys","storage",function(a,b,c){var d,e,f,g,h,i;return d="assets/tac_components",i="tac.keyboard.last",f={t9:{key:"t9",windowClass:"t9-dialog",templateUrl:"t9.html",controller:"tac.keyboard.t9"},qwerty:{key:"qwerty",windowClass:"qwerty-dialog",templateUrl:"qwerty.html",controller:"tac.keyboard.qwerty"}},g=f.qwerty,function(){var a;return(a=c.get(i))&&(g=f[a]||g)}(),h=function(b,d){var e;return b!==g&&(g=b,c.set(i,b.key)),e=a.open({windowClass:b.windowClass,templateUrl:b.templateUrl,controller:b.controller,resolve:{container:function(){return d}}}),d.modal=e,e.result.then(d.edition.success,d.edition.close)},e={set_assets_path:function(a){return d=a},edit:function(a){var c,e,i,j;return b.create_level(),e=[],i=[],j=function(){var a,d;return d={},a=function(){var a;return a={close:function(){var c,d,e,f;if(!a.cancelled){for(b.previous_level(),f=[],d=0,e=i.length;e>d;d++)c=i[d],f.push(c());return f}},success:function(){var d,f,g,h,j,k;if(!a.cancelled){for(b.previous_level(),f=0,h=e.length;h>f;f++)(d=e[f])(c.text);for(k=[],g=0,j=i.length;j>g;g++)d=i[g],k.push(d());return k}}}},{generate:function(){return d.cancelled=!0,d=a()}}}(),c={set_modal:function(a){return c.modal=a,this},edition:j.generate(),assets:d,text:a,to_t9:function(){return c.edition=j.generate(),c.modal.opened.then(function(){return c.modal.close(),h(f.t9,c)})},to_qwerty:function(){return c.edition=j.generate(),c.modal.opened.then(function(){}),c.modal.close(),h(f.qwerty,c)}},h(g,c),{done:function(a){return e.push(a)},exit:function(a){return i.push(a)}}}}}])}).call(this),function(){"use strict";angular.module("module.tac.keyboard").factory("tac.keyboard.content",[function(){var a,b;return a=function(a){var b,c,d,e,f;for(d=[],b=e=0,f=a.length;f>e;b=++e)c=a[b],d.push({key:c,index:b});return d},b=function(b){var c;return c=b.content={},c.erase=function(){return c.before="",c.after="",c.sanitize()},c.write=function(a){return c.before+=a,c.sanitize()},c.remove_one=function(){return c.before=c.before.substring(0,c.before.length-1),c.sanitize()},c.rewrite=function(a){return c.before=c.before.substring(0,c.before.length-1)+a,c.sanitize()},c.init=function(){return c.before=b.text,c.after="",c.sanitize()},c.left=function(){var a;return this.before.length>0?(a=this.before.charAt(this.before.length-1),this.after=a+this.after,this.before=this.before.substring(0,this.before.length-1),this.sanitize(),!0):void 0},c.right=function(){var a;return this.after.length>0?(a=this.after.charAt(0),this.before+=a,this.after=this.after.substring(1,this.after.length),this.sanitize(),!0):void 0},c.sanitize=function(){return b.text=c.before+c.after,c.before_letters=a(c.before),c.after_letters=a(c.after)}},{process:function(a){return a.content||b(a),a.content.init()}}}])}.call(this),function(){"use strict";angular.module("module.tac.keyboard").directive("keyboardInput",[function(){var a,b;return b=60,a=function(a,c){var d,e,f,g;return d=function(){},e=c[0].offsetLeft,g=a[0].scrollLeft+a[0].clientWidth,f=a[0].scrollLeft,e>g-b&&a.scrollLeft(c[0].offsetLeft-a[0].clientWidth+b),f+b>e?a.scrollLeft(c[0].offsetLeft-b):void 0},{restrict:"A",link:function(b,c,d){var e;return e=c.find("#cursor"),b.$watch(function(){return a(c,e)})}}}])}.call(this),function(){"use strict";angular.module("module.tac.keyboard").controller("tac.keyboard.qwerty",["$scope","$modalInstance","tac.keys","tac.navigable.root","tac.navigable.extensible","tac.keyboard.content","container",function(a,b,c,d,e,f,g){var h,i;return a.assets=g.assets,f.process(g),i=d("modal-keyboard-root"),b.result["finally"](function(){return c.unsubscribe(i)}),c.subscribe(i),a.navigable=e.create_vertical("modal-keyboard-main").set_priority(2).bind_to(a,!0),a.navigable.handlers.go_back=function(){return b.dismiss(),!0},a.container=g,h=function(b){return a.has_shift=!1,a.has_simbol=!1,g.content.write(b)},a.tap=function(a){return h(a.content)},a.tap_alphabetic=function(b){return h(a.has_shift?b.content.toUpperCase():b.content)},a.tap_special=function(b){return h(a.has_simbol?b.special:b.content)},a.tap_space=function(){return h(" ")},a.shift=function(){return a.has_shift?a.has_shift=!1:a.has_shift=!0},a.simbol=function(){return a.has_simbol?a.has_simbol=!1:a.has_simbol=!0},i.add(a.navigable),a.resume=function(){return b.dismiss()},a.confirm=function(){return b.close()}}]).controller("tac.keyboard.qwerty.letters",["$scope","tac.navigable.extensible","tac.keyboard.qwerty.buttons","$timeout",function(a,b,c,d){return a.navigable=b.create_multiline("modal-letters-frame",10).set_priority(0).bind_to(a),a.buttons=c}]).factory("tac.keyboard.qwerty.buttons",[function(){return[{kind:"button.special",content:"1",special:"!"},{kind:"button.special",content:"2",special:'"'},{kind:"button.special",content:"3",special:"·"},{kind:"button.special",content:"4",special:"$"},{kind:"button.special",content:"5",special:"%"},{kind:"button.special",content:"6",special:"&"},{kind:"button.special",content:"7",special:"/"},{kind:"button.special",content:"8",special:"("},{kind:"button.special",content:"9",special:")"},{kind:"button.special",content:"0",special:"="},{kind:"alphabetic",content:"q"},{kind:"alphabetic",content:"w"},{kind:"alphabetic",content:"e"},{kind:"alphabetic",content:"r"},{kind:"alphabetic",content:"t"},{kind:"alphabetic",content:"y"},{kind:"alphabetic",content:"u"},{kind:"alphabetic",content:"i"},{kind:"alphabetic",content:"o"},{kind:"alphabetic",content:"p"},{kind:"alphabetic",content:"a"},{kind:"alphabetic",content:"s"},{kind:"alphabetic",content:"d"},{kind:"alphabetic",content:"f"},{kind:"alphabetic",content:"g"},{kind:"alphabetic",content:"h"},{kind:"alphabetic",content:"j"},{kind:"alphabetic",content:"k"},{kind:"alphabetic",content:"l"},{kind:"alphabetic",content:"ñ"},{kind:"alphabetic",content:"z"},{kind:"alphabetic",content:"x"},{kind:"alphabetic",content:"c"},{kind:"alphabetic",content:"v"},{kind:"alphabetic",content:"b"},{kind:"alphabetic",content:"n"},{kind:"alphabetic",content:"m"},{kind:"button",content:","},{kind:"button",content:"."},{kind:"button",content:"?"}]}])}.call(this),angular.module("module.tac.keyboard").run(["$templateCache",function(a){"use strict";a.put("qwerty.alphabetic.html",'<a class="button alphabetic" \n  ng-click="tap_alphabetic(button)"\n  navigable-leaf-model="button"\n  ng-class="{hover:button.navigable.active}"\n  href>\n  <div ng-hide="has_shift">\n    {{button.content}}\n  </div>\n  <div ng-show="has_shift">\n    {{button.content.toUpperCase()}}\n  </div>\n</a>'),a.put("qwerty.button.html",'<a class="button key-button" \n  ng-click="tap(button)"\n  navigable-leaf-model="button"\n  ng-class="{hover:button.navigable.active}"\n  href>\n  <div>\n    {{button.content}}\n  </div>\n</a>\n'),a.put("qwerty.button.special.html",'<a class="button key-button-special" \n  ng-click="tap_special(button)"\n  navigable-leaf-model="button"\n  ng-class="{hover:button.navigable.active}"\n  href>\n  <div ng-hide="has_simbol">\n    {{button.content}}\n  </div>\n  <div ng-show="has_simbol">\n    {{button.special}}\n  </div>\n</a>'),a.put("qwerty.html",'<div>\n  <div class="modal-body" >\n    <div class="main-frame" >\n      <div class="input-frame" keyboard-input id="input-frame">\n       <div class="input" >\n         <span ng-repeat="letter in container.content.before_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n       </div>\n       <div class="cursor" id="cursor"></div>\n       <div class="input">\n         <span ng-repeat="letter in container.content.after_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n       </div>\n      </div>\n      <div class="letters-frame" ng-controller="tac.keyboard.qwerty.letters">\n        <div ng-repeat="button in buttons">\n          <div ng-include="\'qwerty.\' + button.kind +\'.html\'"> </div>\n        </div>\n      </div>\n      <div class="actions-frame" \n        ng-controller="tac.navigable.horizontal"\n        identifier="image header" \n        priority="1"\n        >\n        <a class="button shift" \n          ng-click="$parent.shift()"\n          navigable-leaf="0"\n          navigable-leaf-id="shift-button"\n          navigable-leaf-class="hover"\n          href>\n          <svg class="shift-icon" inline-svg-model="{{assets}}/qwerty/shift.svg"></svg>\n        </a>\n        <a class="button simbols" \n          ng-click="$parent.simbol()"\n          navigable-leaf="1"\n          navigable-leaf-id="simbol-button"\n          navigable-leaf-class="hover"\n          href>\n          <span>#$%</span>\n        </a>\n        <a class="button space" \n          ng-click="tap_space()"\n          navigable-leaf="2"\n          navigable-leaf-id="space-button"\n          navigable-leaf-class="hover"\n          href>\n          <span>espacio</span>\n        </a>\n        <a class="button delete"\n          ng-click="container.content.remove_one()"\n          navigable-leaf="3"\n          navigable-leaf-id="delete-button"\n          navigable-leaf-class="hover"\n          href>\n          <span>borrar</span>\n        </a>\n      </div>\n    </div>\n  </div>\n  \n  <div class="modal-footer">\n    <div class="modal-controls"\n      ng-controller="tac.navigable.horizontal"\n      identifier="image header" \n      priority="2">\n      <a class="modal-close" \n        navigable-leaf="2"\n        navigable-leaf-id="resume image modal"\n        navigable-leaf-class="hover" \n        ng-click="confirm()"\n        href >\n        Aceptar\n      </a>\n      <a class="modal-resume" \n        navigable-leaf="1"\n        navigable-leaf-id="resume image modal"\n        navigable-leaf-class="hover" \n        ng-click="resume()"\n        href >\n        Cancelar\n      </a>\n      <a class="keyboard-next" \n        navigable-leaf="0"\n        navigable-leaf-id="resume image modal"\n        navigable-leaf-class="hover" \n        ng-click="container.to_t9()"\n        href >\n        Teclado T9\n      </a>\n    </div>\n  </div>\n</div>')}]),function(){"use strict";angular.module("module.tac.keyboard").controller("tac.keyboard.t9",["$scope","$modalInstance","$timeout","tac.keys","tac.keyboard.content","tac.keyboard.t9.buttons","tac.keyboard.t9.options","container",function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r;return a.assets=h.assets,e.process(h),r=800,l=function(){return $("#delay-bar")},a.buttons=f,a.options=g,a.back_btn={},a.menu_btn={},a.mode=p={},n={time:(new Date).getTime(),button:!1},j=function(){return l().width("100%"),j.animate=!0,l().animate({width:"0%"},r)},j.stop=function(){return j.animate?(l().stop(),l().width("0%"),j.animate=!1):void 0},o=function(a){return n.time=(new Date).getTime(),n.button=a},q=function(a){return n.button===a&&(new Date).getTime()-n.time<r},m=function(a){var b,c,d,e;for(c=String(a),d=0,e=f.length;e>d;d++)if(b=f[d],b.key===c)return b;return console.log("sin boton para "+a)},i=function(b){return b.klass="pressed",a.$apply(),c(function(){return b.klass="",a.$apply()},200)},k={handlers:{right:function(){return h.content.right(),a.$apply()},left:function(){return h.content.left(),a.$apply()},menu:function(){return k.to_menu_mode(),i(a.menu_btn)},anterior:function(a){return i(m(a.key)),h.content.remove_one()},go_back:function(b){return k.prev(),i(a.back_btn)},enter:function(a){return b.close()}},handle_button:function(a){var b;return b=m(a),q(b)?(b.times+=1,k.current.relapse(b)):(k.current.once(b),b.times=0),i(b),o(b)},zero:function(){var a;return a=m(0),"numbers"===this.current.mode?write("0"):write(" "),i(a),!0},one:function(){return i(m(1)),this.next()},handle:function(a){var b;return j.stop(),a.is_number?p.menu&&this.menu.handle(a.number)||0===a.number&&this.zero()||1===a.number&&this.one()||this.handle_button(a.number):(b=this.handlers[a.key],b&&b(a))},next:function(){return this.current_index+1<this.states.length?(this.set_state(this.current_index+1),!0):!1},prev:function(){return this.current===this.menu?this.set_state(this.current_index):this.current_index>0?this.set_state(this.current_index-1):b.close(),!0},set_state:function(a){return p[this.current.mode]=!1,this.current_index=a,this.current=this.states[this.current_index],p[this.current.mode]=!0},initialize:function(){return this.current_index=0,this.current=this.states[this.current_index],p[this.current.mode]=!0},menu:{mode:"menu",handle:function(c){switch(c){case 1:h.to_qwerty();break;case 2:h.content.erase(),k.prev(),a.$apply();break;case 3:b.dismiss()}return!0}},to_menu_mode:function(){return p[this.current.mode]=!1,this.current=this.menu,p[this.current.mode]=!0},states:[{mode:"letters",once:function(a){return h.content.write(a.letters.charAt(0)),j()},relapse:function(a){var b;return b=a.times%a.letters.length,h.content.rewrite(a.letters.charAt(b)),j()}},{mode:"mayusc",once:function(a){return h.content.write(a.mayusc.charAt(0)),j()},relapse:function(a){var b;return b=a.times%a.mayusc.length,h.content.rewrite(a.mayusc.charAt(b)),j()}},{mode:"symbol",once:function(a){return h.content.write(a.symbol.charAt(0)),j()},relapse:function(a){var b;return b=a.times%a.symbol.length,h.content.rewrite(a.symbol.charAt(b)),j()}},{mode:"numbers",once:function(a){return h.content.write(a.number)},relapse:function(a){return this.once(a)}}]},k.initialize(),h.content.sanitize(),b.result["finally"](function(){return d.unsubscribe(k)}),d.subscribe(k),a.container=h,a.controller=k}]).factory("tac.keyboard.t9.buttons",[function(){var a;return a=function(a,b,c,d,e){return{key:a,number:b||"",letters:c||"",mayusc:d||"",symbol:e||""}},[a("1","1"),a("2","2","abc","ABC",".:$"),a("3","3","def","DEF",",;("),a("4","4","ghi","GHI","@*["),a("5","5","jkl","JKL","-+{"),a("6","6","mnño","MNÑO","?¿)"),a("7","7","pqrs","PQRS","!¡]"),a("8","8","tuv","TUV","/=}"),a("9","9","wxyz","WXYZ","#_&"),a("epg"),a("0","0","_","_","_"),{key:"anterior",name:"<[X]",svg:"backspace"}]}]).factory("tac.keyboard.t9.options",[function(){return[{key:"1",description:"Cambiar a teclado querty"},{key:"2",description:"Borrar texto"},{key:"3",description:"Cancelar edicion"}]}])}.call(this),angular.module("module.tac.keyboard").run(["$templateCache",function(a){"use strict";a.put("t9.html",'<div>\n  <div class="modal-body" >\n    <div class="main-frame" >\n      <div class="input-frame" keyboard-input id="input-frame">\n       <div class="input" >\n         <span ng-repeat="letter in container.content.before_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n       </div>\n       <div class="cursor" id="cursor"></div>\n       <div class="input">\n         <span ng-repeat="letter in container.content.after_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n       </div>\n      </div>\n      <div class="delay-frame">\n        <div class="delay-bar" id="delay-bar">\n        </div>\n      </div>\n      <div class="menu-frame">\n        <div class="menu" ng-class="{\'disable\':mode.menu}">\n          <a class="menu-btn" ng-class="menu_btn.klass" ng-click="controller.to_menu_mode()" href>\n            menu\n          </a>\n        </div>\n      </div>\n      <div class="go-back-frame">\n        <div class="go-back">\n          <a class="go-back-btn" ng-click="controller.prev()" ng-class="back_btn.klass" href>\n            volver\n          </a>\n        </div>\n        <div class="go-back-description">\n          <span ng-hide="!mode.letters">\n            Cerrar teclado\n          </span>\n          <span ng-show="mode.mayusc">\n            Volver a modo minuscula\n          </span>\n          <span ng-show="mode.symbol">\n            Volver a modo texto\n          </span>\n          <span ng-show="mode.numbers">\n            Volver a modo simbolos\n          </span>\n          <span ng-show="mode.menu">\n            Ocultar opciones\n          </span>\n        </div>\n      </div>\n      <div class="buttons-frame" ng-hide="mode.menu">\n        <div ng-hide="mode.numbers" ng-click="controller.next()" class="modes" href>\n          <a class="mode letters" ng-class="{\'selected\':mode.letters}">\n            abc\n          </a>\n          <a class="mode mayusc" ng-class="{\'selected\':mode.mayusc}">\n            ABC\n          </a>\n          <a class="mode symbol" ng-class="{\'selected\':mode.symbol}">\n            @.?,\n          </a>\n          <a class="mode numbers">\n            123\n          </a>\n        </div>\n        <a ng-show="mode.numbers" class="button" ng-class="buttons[0].klass" href>\n          {{buttons[0].key}}\n        </a>\n        <div ng-repeat="button in buttons" ng-show="$index!=0">\n          <a class="button" ng-class="button.klass" href>\n            <div ng-if="button.svg" class="svg-button" inline-svg-model="{{assets}}/t9/{{button.svg}}.svg"></div>\n            <div ng-if="!button.svg" ng-show="button.name">\n              {{button.name}}\n            </div>\n            <div ng-if="!button.svg" ng-show="!button.name">\n              <div ng-hide="!mode.letters">\n                {{button.letters}}\n              </div>\n              <div ng-show="mode.mayusc">\n                {{button.mayusc}}\n              </div>\n              <div ng-show="mode.symbol">\n                <span class="symbol" ng-repeat="symbol in button.symbol">\n                  {{symbol}}\n                </span>\n              </div>\n              <div ng-show="mode.numbers">\n                {{button.number}}\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n      <div class="options-frame" ng-show="mode.menu">\n        <a ng-repeat="option in options" class="option" ng-class="option.klass" href>\n          <div class="option-key">\n            {{option.key}}\n          </div>\n          <div class="option-description">\n            {{option.description}}\n          </div>\n        </a>\n      </div>\n    </div>\n  </div>\n</div>')}]);